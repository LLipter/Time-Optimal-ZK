\chapter{Zero-Knowledge Proofs for LWE}

\section{Introduction}

LWE (Learning with error) problem is the fundamental lattice problem upon which most of the lattice-based cryptography rests. LWE states that it is hard to distinguish a uniformly random tuple $(A, u)$ and $(A, u = As+e)$, where all elements of $s$ and $e$ are small. In this chapter, we explore a protocol in \cite{lwe} that makes use of polynomials to prove knowledge of $s$ and $e$ with small elements that satisfy:
$$
    As + e = u
$$

\begin{definition}[Relation $R_{LWE}$]
The relation $R_{LWE}$ is the sets of tuples
$$
    (\mathbb{X}, \mathbb{W}) = ((\mathbb{F}, n, m), (A, u, s, e))
$$ 
such that $A \in \mathbb{F}^{n \times m}$, $u \in \mathbb{F}^{n}$, $s \in \{-1, 0, 1\}^{m}$, $e \in \{-1, 0, 1\}^{n}$ and $As + e = u$.
\end{definition}

\section{LWE Protocol}

In this protocol, the prover $\mathcal{P}$ is allowed to send a tuple $a = (a_1, \cdots, a_l)$ where $a_i \in \mathbb{F}^k$. And the verifier $\mathcal{V}$ has linear query access to it by send a coefficient tuple $b = (b_1, \cdots, b_l)$ where $b_i \in \mathbb{F}$. The response will a array $e$ where $e_j = \langle (a_1[j], \cdots, a_l[j]), b  \rangle$.

Prover $\mathcal{P}$'s input: $A \in \mathbb{F}^{n \times m}$, $u \in \mathbb{F}^{n}$, $s \in \{-1, 0, 1\}^{m}$ and $e \in \{-1, 0, 1\}^{n}$ such that $u = As + e$.

Verifier $\mathcal{V}$'s input: $A \in \mathbb{F}^{n \times m}$, $u \in \mathbb{F}^{n}$.

The protocol proceeds as follows.



\begin{itemize}
    \item $\mathcal{P}$ samples $t \leftarrow \mathbb{F}^{m}$ and computes the polynomials $f(X)=tX+s$ and $d(X)=u-Af(X)$.
    \item $\mathcal{P}$ computes the polynomials:
\begin{equation}
\label{eq:lwe1}
    \frac{1}{X} f(X) \circ [f(X) - 1^m] \circ [f(X) + 1^m] = v_2X^2 + v_1X + v_0
\end{equation}
\begin{equation}
\label{eq:lwe2}
    \frac{1}{X} d(X) \circ [d(X) - 1^m] \circ [d(X) + 1^m] = w_2X^2 + w_1X + w_0
\end{equation}

    \item $\mathcal{P}$ sends $(t, s), (-At, u-As), (v_2, v_1, v_0), (w_2, w_1, w_0)$ to $\mathcal{V}$, and $\mathcal{V}$ has linear query access to each of these tuples.
    
    \item $\mathcal{V}$ sample a random challenge $x \leftarrow \mathbb{F}^*$.
    
    \item $\mathcal{V}$ sends linear query to $(t, s)$ with coefficient vector $(x, 1)$. Denote the response as $f$.
    \item $\mathcal{V}$ sends linear query to $(-At, u-As)$ with coefficient vector $(x, 1)$. Denote the response as $d$.
    \item $\mathcal{V}$ sends linear query to $(v_2, v_1, v_0)$ with coefficient vector $(x^2, x, 1)$. Denote the response as $g$.
    \item $\mathcal{V}$ sends linear query to $(w_2, w_1, w_0)$ with coefficient vector $(x^2, x, 1)$. Denote the response as $h$.
    
    \item $\mathcal{V}$ will check whether the following equation holds:
$$
    g \overset{?}{=} \frac{1}{x} (f \circ [f - 1^m] \circ [f + 1^m])
$$
$$
    h \overset{?}{=} \frac{1}{x} (d \circ [d - 1^m] \circ [d + 1^m])
$$
\end{itemize}

\begin{lemma}
\label{lemma:lwepc}

LWE = ($\mathcal{P}$, $\mathcal{V}$) has \textbf{perfect completeness}.

\end{lemma}
\begin{proof}

According to equation \ref{eq:lwe1}, the first checking will succeed. And according to equation \ref{eq:lwe2}, the second checking will succeed.

\end{proof}

\begin{lemma}
\label{lemma:lwese}

LWE = ($\mathcal{P}$, $\mathcal{V}$) has has soundness error at most $\frac{2}{q}$, where $q$ is the size of the underlying field.

\end{lemma}
\begin{proof}

Suppose $(\mathbb{X}, \mathbb{W}) = ((\mathbb{F}, n, m), (A, u, s, e))$ is not in relation $R_{LWE}$. Then either $\frac{1}{X} f(X) \circ [f(X) - 1^m] \circ [f(X) + 1^m]$ and $v_2X^2 + v_1X + v_0$ are different polynomials, or $\frac{1}{X} d(X) \circ [d(X) - 1^m] \circ [d(X) + 1^m]$ and $w_2X^2 + w_1X + w_0$ are different polynomials. Note that they are polynomials with degree equal 2. According to Schwartz-Zippel lemma, they can agree on at most 2 positions. Since challenge $x$ is sampled randomly from $\mathbb{F}$, the probability this event appears is at most $\frac{2}{q}$.

Suppose $(\mathbb{X}, \mathbb{W}) = ((\mathbb{F}, n, m), (A, u, s, e))$ is in relation $R_{LWE}$, but the prover $\mathbb{P}$ sends a incorrect polynomials $g^\prime$ or $h^\prime$. Likewise, since they are polynomials with degree equal 2, according to Schwartz-Zippel lemma, they can agree on at most 2 positions. The probability that the verifier accepts the protocol is also at most $\frac{2}{q}$.


\end{proof}

\begin{lemma}
\label{lemma:lwezk}

LWE = ($\mathcal{P}$, $\mathcal{V}$) is zero-knowledge.

\end{lemma}
\begin{proof}

The simulator $\mathcal{S}(A, u)$ can generate the transcript as follows:

\begin{itemize}
    \item $\mathcal{S}$ samples $f \in \mathbb{F}^m$ uniformly at random.
    \item $\mathcal{S}$ samples $x \in \mathbb{F}$ uniformly at random.
    \item $\mathcal{S}$ computes $d = u - Af$.
    \item $\mathcal{S}$ computes $g = \frac{1}{x} (f \circ [f - 1^m] \circ [f + 1^m])$
    \item $\mathcal{S}$ computes $h = \frac{1}{x} (d \circ [d - 1^m] \circ [d + 1^m])$
    \item $\mathcal{S}$ outputs $(x, f, d, g, h)$
\end{itemize}

$x$ is uniformly random both in the simulator $\mathcal{S}(A, u)$ and in the real world. 

$f$ is uniformly random in the simulator $\mathcal{S}(A, u)$. In the real world, $f$ looks random because $t$ is sampled uniformly at random.

$d, g, h$ are computed using the same equation both in the simulator $\mathcal{S}(A, u)$ and in the real world. They are indistinguishable to each other.

\end{proof}